{% extends 'base.html' %}
{% load static %}

{% block title %}
  <title>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</title>
  <link rel="icon" type="image/x-icon" href="{% static 'icons/icons8-brutus-32.ico' %}">
  <link rel="stylesheet" href="{% static 'css/room-for-sell.css' %}">
{% endblock %}

{% block body %}

<div class="menu-button-wrapper">
  {% if user.username %}
    <div id="menu" class="styled-button" onclick="redirectToMenu()">
      üî• <span>–ú–µ–Ω—é</span> üî•
    </div>
  {% else %}
    <div id="menu" class="styled-button" onclick="redirectToMenuNone()">
      üî• <span>–ú–µ–Ω—é</span> üî•
    </div>
  {% endif %}
</div>

<div class="username-display">
  {% if user.username %}
    <a href="/settings" class="login-link">üë§ {{ user.username }}</a>
    <a href="/wallet" class="login-link">({{ user.wallet }})</a>
  {% else %}
    üë§ –í–∏ –Ω–µ —É–≤—ñ–π—à–ª–∏ –≤ –∞–∫–∞—É–Ω—Ç<br>
    <a href="/login" class="login-link">–£–≤—ñ–π—Ç–∏</a>
  {% endif %}
  <div class="switch-wrapper">
    <label class="switch" title="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">
      <input type="checkbox" id="themeToggle" aria-label="Theme toggle">
      <span class="slider"></span>
    </label>
  </div>
</div>

<!-- –§–æ—Ä–º–∞ -->
<div class="background rooms-wiew">
  <div class="container">
    <form method="post" action="/room-for-sell/{{ user.id }}" enctype="multipart/form-data" class="form">
      {% csrf_token %}
      <h1>–í–∏—Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∂</h1>

      <label>–ù–∞–∑–≤–∞:
        <input type="text" name="title" required>
      </label>

      <label>–§–æ—Ç–æ:
        <input type="file" name="photo" accept="image/*" id="photoInput" required>
      </label>
      <br>
      <img id="photoPreview" src="#" alt="–ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ" style="display:none; max-width: 300px; margin-top: 10px;">

      <label>–¶—ñ–Ω–∞ –∑–∞ –¥–µ–Ω—å:
        <input type="text" name="price" value="{{ room.price|floatformat:0 }}" required>
      </label>

      <label>–ê–¥—Ä–µ—Å–∞:
        <input type="text" name="address" required>
      </label>

      <label>–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:
        <input type="text" name="phone_number" value="{{ user.phone_number }}" required>
      </label>
      <button type="submit" class="btn">–í–∏—Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∂</button>
    </form>
  </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç—ã -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("themeToggle");
    const html = document.documentElement;

    if (localStorage.getItem("darkTheme") === "true") {
      html.classList.add("dark-theme");
      toggle.checked = true;
    }

    toggle.addEventListener("change", function () {
      html.classList.toggle("dark-theme", this.checked);
      localStorage.setItem("darkTheme", this.checked);
    });

    const photoInput = document.getElementById('photoInput');
    const photoPreview = document.getElementById('photoPreview');

    photoInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.addEventListener('load', function () {
          photoPreview.setAttribute('src', this.result);
          photoPreview.style.display = 'block';
        });
        reader.readAsDataURL(file);
      } else {
        photoPreview.style.display = 'none';
        photoPreview.setAttribute('src', '#');
      }
    });
  });

  function redirectToMenu() {
    window.location.href = "/menu/{{ user.id }}";
  }

  function redirectToMenuNone() {
    window.location.href = "/menu/none";
  }
</script>
{% endblock %}
