{% extends 'base.html' %}
{% load static %}

{% block title %}
    <title>–û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫—ñ–º–Ω–∞—Ç—É</title>
    <link rel="icon" type="image/x-icon" href="{% static 'icons/icons8-brutus-32.ico' %}">
    <link rel="stylesheet" href="{% static 'css/update-room.css' %}">
{% endblock %}

{% block body %}

<div class="username-display">
  {% if user.username %}
    <a href="/settings" class="login-link">üë§ {{ user.username }}</a>
    <a href="/wallet" class="login-link">({{ user.wallet }})</a>
  {% else %}
    üë§ –í–∏ –Ω–µ —É–≤—ñ–π—à–ª–∏ –≤ –∞–∫–∞—É–Ω—Ç<br>
    <a href="/login" class="login-link">–£–≤—ñ–π—Ç–∏</a>
  {% endif %}
  <div class="switch-wrapper">
    <label class="switch" title="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">
      <input type="checkbox" id="themeToggle" aria-label="Theme toggle">
      <span class="slider"></span>
    </label>
  </div>
</div>

<div class="background">
  <div style="margin-top: 0px;">
    <div class="container">
        <form method="post" action="{% url 'update_room' user.id room.id %}" enctype="multipart/form-data" class="form">
            {% csrf_token %}
            <h1>–û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫—ñ–º–Ω–∞—Ç—É</h1>
            {% if messages %}
              {% for message in messages %}
                <p class="
                  {% if 'success' in message.tags %}
                    message
                  {% elif 'error' in message.tags %}
                    error-msg
                  {% else %}
                    info-msg
                  {% endif %}
                ">
                  {{ message }}
                </p>
              {% endfor %}
            {% endif %}

            <label class="label-text">–ù–∞–∑–≤–∞:
                <input type="text" name="title" value="{{ room.title }}" required>
            </label>
        
            <label class="label-text">–§–æ—Ç–æ (–∑–∞–ª–∏—à –ø–æ—Ä–æ–∂–Ω—ñ–º, —â–æ–± –Ω–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏):
                <input type="file" id="photoInput" name="photo" accept="image/*">
            </label>
            <br>
            <img id="photoPreview" 
                 src="{{ room.photo.url }}" 
                 alt="–§–æ—Ç–æ –∫—ñ–º–Ω–∞—Ç–∏" 
                 style="max-width: 300px; margin-top: 10px; {% if not room.photo %}display:none;{% endif %}">
        
            <label class="label-text">–¶—ñ–Ω–∞ –∑–∞ –¥–µ–Ω—å:
                <input type="text" name="price" value="{{ room.price|floatformat:0 }}" required>
            </label>

        
            <label class="label-text">–ê–¥—Ä–µ—Å–∞:
                <input type="text" name="address" value="{{ room.address }}" required>
            </label>
        
            <label class="label-text">–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:
                <input type="text" name="phone_number" value="{{ room.phone_number }}" required>
            </label>
        
            <button type="submit" class="btn">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
          </form>
        </div>
    </div>
</div>

<div id="menu" class="styled-button" onclick="redirectToMenu()">
  üî• <span style="color: #6a5acd; text-decoration: none; font-weight: bold;">–ú–µ–Ω—é</span> üî•
</div>
<script>
function redirectToMenu() {
    window.location.href = "/menu/{{ user.id }}";
}
</script>

<script>
  const photoInput = document.getElementById('photoInput');
  const photoPreview = document.getElementById('photoPreview');

  photoInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();

      reader.addEventListener('load', function() {
        photoPreview.src = this.result;
        photoPreview.style.display = 'block';
      });

      reader.readAsDataURL(file);
    } else {
      if (!photoPreview.src || photoPreview.src === window.location.href) {
        photoPreview.style.display = 'none';
      }
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("themeToggle");
    const html = document.documentElement;

    if (localStorage.getItem("darkTheme") === "true") {
      html.classList.add("dark-theme");
      toggle.checked = true;
    }

    toggle.addEventListener("change", function () {
      html.classList.toggle("dark-theme", this.checked);
      localStorage.setItem("darkTheme", this.checked);
    });
  });
</script>

{% endblock %}
