{% extends 'base.html' %}
{% load static %}

{% block title %}
    <title>{{ title }}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'icons/icons8-brutus-32.ico' %}">
    <link rel="stylesheet" href="{% static 'css/rooms_list.css' %}">
{% endblock %}

{% block body %}
<div class="username-display">
  {% if user.username %}
    <a href="/settings" class="login-link">üë§ {{ user.username }}</a>
    <a href="/wallet" class="login-link">({{ user.wallet }})</a>
  {% else %}
    üë§ –í–∏ –Ω–µ —É–≤—ñ–π—à–ª–∏ –≤ –∞–∫–∞—É–Ω—Ç<br>
    <a href="/login" class="login-link">–£–≤—ñ–π—Ç–∏</a>
  {% endif %}
  <div class="switch-wrapper">
    <label class="switch" title="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">
      <input type="checkbox" id="themeToggle" aria-label="Theme toggle">
      <span class="slider"></span>
    </label>
  </div>
</div>

<div class="container">
    <h1>{{ title }}</h1>
    <ul style="list-style:none; padding:0;">
      {% for room in rooms %}
        <li style="margin-bottom:10px; display:flex; justify-content: space-between; align-items:center; max-width:600px; border-bottom:1px solid #ccc; padding-bottom:8px;">
          <a href="{% url 'update_room' room.owner.id room.id %}" 
             style="flex-grow:1; text-decoration:none; color:#333; font-weight:bold; display:flex; flex-direction: column; gap:4px;">
            <span class="white-text">{{ room.title }}</span>
            <span class="white-text" style="font-weight: normal;">–ê–¥—Ä–µ—Å–∞: {{ room.address }}</span>
            <span class="white-text" style="font-weight: normal;">–¶—ñ–Ω–∞: {{ room.price|floatformat:"0" }} –≥—Ä–Ω</span>
          </a>
          {% if room.photo %}
            <img 
              src="{{ room.photo.url }}" 
              alt="–§–æ—Ç–æ –∫—ñ–º–Ω–∞—Ç–∏" 
              style="width: 80px; height: 80px; object-fit: cover; margin-left: 15px; border-radius: 8px;">
          {% endif %}
          <form method="post" action="{% url 'delete-room' room.id %}" style="margin:0 0 0 15px;">
            {% csrf_token %}
            <input type="hidden" name="room_id" value="{{ room.id }}">
            <button type="submit" style="background:none; border:none; color:red; cursor:pointer;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
          </form>
        </li>
      {% empty %}
        <li>–ö—ñ–º–Ω–∞—Ç –Ω–µ–º–∞—î</li>
      {% endfor %}
    </ul>
</div>

<div id="menu" class="styled-button" onclick="redirectToMenu()">
  üî• <span style="color: #6a5acd; text-decoration: none; font-weight: bold;">–ú–µ–Ω—é</span> üî•
</div>


<script>
function redirectToMenu() {
    window.location.href = "/menu/{{ user.id }}";
}

document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("themeToggle");
    const html = document.documentElement;

    if (localStorage.getItem("darkTheme") === "true") {
        html.classList.add("dark-theme");
        toggle.checked = true;
    }

    toggle.addEventListener("change", function () {
        html.classList.toggle("dark-theme", this.checked);
        localStorage.setItem("darkTheme", this.checked);
    });
});
</script>
{% endblock %}
